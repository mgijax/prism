#!/bin/csh -f

#
# Install
#
cd `dirname $0` && source ./Configuration

# Unpack ExtJS and create link
#
cd ./www/js 
rm -fr ${EXT} ext
gunzip -c ${EXT}.tar.gz | tar xvf -
ln -s ${EXT} ext
cd ../..

#
# Copy index.html to top level dir.
cp -f ./www/html/index.html .

# Create prismConfig.py, containing copies of env vars
# needed by server.
#
cat > ./server/prismConfig.py <<EOF
# prismConfig.py
#
# Configuration parameters for imagePaneData CGI service.
#
# DO NOT EDIT THIS FILE.
# This file was generated by the installer. To change anything,
# edit the Configuration file, then rerun Install.
#
MGI_LIVE = "${MGI_LIVE}"
MGI_PYTHONLIB="${MGI_PYTHONLIB}"
MGI_PUBLICUSER="${MGI_PUBLICUSER}"
MGI_PUBLICPASSWORD = "${MGI_PUBLICPASSWORD}"
PG_DBSERVER = "${PG_DBSERVER}"
PG_DBNAME = "${PG_DBNAME}"
MGD_DBPASSWORDFILE = "${MGD_DBPASSWORDFILE}"
MGD_DBSERVER = PG_DBSERVER
MGD_DBNAME = PG_DBNAME
EOF

# Create prism-config.js, containing copies of env vars
# needed by client.
#
cat > ./www/js/prism-config.js <<EOF2
// prism-config.js
//
// Configuration parameters for Prism web client.
//
// DO NOT EDIT THIS FILE.
// This file was generated by the installer. To change anything,
// edit the Configuration file, then rerun Install.
//
Ext.namespace('PRISM');

PRISM.config = {
    IMAGEPANE_URL : "${IMAGEPANE_URL}",
    PIXELDB_FETCH_URL : "${PIXELDB_FETCH_URL}",
    PIXELDB_UPLOAD_URL : "${PIXELDB_UPLOAD_URL}",
    JFILE_URL : "${JFILE_URL}",
    HELP_URL : "${HELP_URL}",
    PG_DBSERVER : "${PG_DBSERVER}",
    PG_DBNAME : "${PG_DBNAME}",
    MGD_DBSERVER : "${PG_DBSERVER}",
    MGD_DBNAME : "${PG_DBNAME}",
    MGD_DBPASSWORDFILE : "${MGD_DBPASSWORDFILE}"
};
EOF2
